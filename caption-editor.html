<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caption Editor - Anniversary Candy Crush</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            text-align: center;
            color: #FF69B4;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }
        .instructions {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #FF69B4;
        }
        .instructions h3 {
            margin-top: 0;
            color: #FF69B4;
        }
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .photo-card {
            background: #16213e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .photo-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
        .photo-info {
            padding: 15px;
        }
        .photo-filename {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            word-break: break-all;
        }
        .photo-info label {
            display: block;
            font-size: 12px;
            color: #FF69B4;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .photo-info textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #0f0f23;
            color: #fff;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s;
        }
        .photo-info textarea:focus {
            outline: none;
            border-color: #FF69B4;
        }
        .photo-info textarea::placeholder {
            color: #555;
        }
        .messages-section {
            background: #16213e;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .messages-section h2 {
            color: #FFD700;
            margin-top: 0;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .message-group {
            margin-bottom: 20px;
        }
        .message-group label {
            display: block;
            font-size: 12px;
            color: #FF69B4;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .message-group input,
        .message-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #0f0f23;
            color: #fff;
            font-size: 14px;
        }
        .message-group input:focus,
        .message-group textarea:focus {
            outline: none;
            border-color: #FF69B4;
        }
        .output-section {
            background: #0d1117;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
        }
        .output-section h2 {
            color: #58a6ff;
            margin-top: 0;
        }
        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
        }
        .btn-copy {
            background: linear-gradient(135deg, #58a6ff, #1f6feb);
            color: white;
        }
        #output {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 500px;
            overflow-y: auto;
            color: #c9d1d9;
        }
        .copied-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #238636;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        .copied-toast.show {
            opacity: 1;
        }
        .photo-number {
            background: #FF69B4;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }
        .photo-card {
            position: relative;
        }
    </style>
</head>
<body>
    <h1>Caption Editor</h1>
    <p class="subtitle">Anniversary Candy Crush - Photo & Message Configuration</p>

    <div class="instructions">
        <h3>How to use</h3>
        <ol>
            <li>Enter a caption for each photo below (these appear when the memory is revealed in-game)</li>
            <li>Customize the game messages (start screen, victory screen, etc.)</li>
            <li>Click "Generate Config" to create the configuration</li>
            <li>Copy the output and share it - I'll update your config file!</li>
        </ol>
    </div>

    <h2 style="color: #FFD700;">Photo Captions</h2>
    <div class="photo-grid" id="photoGrid"></div>

    <div class="messages-section">
        <h2>Game Messages</h2>

        <div class="message-group">
            <label>Start Screen Title</label>
            <input type="text" id="msg-title" value="Happy Anniversary!" placeholder="e.g., Happy Anniversary, Happy Birthday" maxlength="100">
        </div>

        <div class="message-group">
            <label>Start Screen Subtitle</label>
            <input type="text" id="msg-subtitle" value="A game made with love, just for you" placeholder="e.g., A game made with love, just for you" maxlength="200">
        </div>

        <div class="message-group">
            <label>Start Button Text</label>
            <input type="text" id="msg-startButton" value="Begin Our Journey" placeholder="e.g., Begin Our Journey, Let's Play" maxlength="50">
        </div>

        <div class="message-group">
            <label>Loading Screen Message</label>
            <textarea id="msg-loadingMessage" rows="3" placeholder="Message shown while game loads" maxlength="500">A personalized game to relive our favorite memories together.</textarea>
        </div>

        <div class="message-group">
            <label>Victory Screen Title</label>
            <input type="text" id="msg-victoryTitle" value="Our Love Story" placeholder="Shown after all memories are revealed" maxlength="100">
        </div>

        <div class="message-group">
            <label>Victory Screen Subtitle</label>
            <input type="text" id="msg-victorySubtitle" value="Every moment with you is a treasure" placeholder="Subtitle on victory screen" maxlength="200">
        </div>

        <div class="message-group">
            <label>Final Message</label>
            <textarea id="msg-finalMessage" rows="3" placeholder="The heartfelt message shown at the end" maxlength="1000">Here's to many more adventures together!</textarea>
        </div>

        <div class="message-group">
            <label>Signature</label>
            <input type="text" id="msg-signature" value="With all my love" placeholder="e.g., Forever yours, With all my love" maxlength="100">
        </div>
    </div>

    <div class="output-section">
        <h2>Generated Configuration</h2>
        <div class="button-row">
            <button class="btn-primary" onclick="generateConfig()">Generate Config</button>
            <button class="btn-copy" onclick="copyToClipboard()">Copy to Clipboard</button>
        </div>
        <pre id="output">Click "Generate Config" to see the output here...</pre>
    </div>

    <div class="copied-toast" id="toast">Copied to clipboard!</div>

    <script>
        // Security: HTML escape function to prevent XSS
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Photos and captions from customize/my-config.js (CHRONOLOGICAL ORDER)
        const photos = [
            "photo-01.svg",
            "photo-02.svg",
            "photo-03.svg",
            "photo-04.svg",
            "photo-05.svg",
            "photo-06.svg",
            "photo-07.svg",
            "photo-08.svg",
            "photo-09.svg",
            "photo-10.svg"
        ];

        // Current captions from my-config.js (CHRONOLOGICAL ORDER)
        const defaultCaptions = [
            "Our first date at the coffee shop downtown",
            "The day we adopted our furry friend",
            "Moving into our first apartment together",
            "That unforgettable road trip adventure",
            "Celebrating our first anniversary",
            "The surprise birthday party you planned",
            "Our favorite hiking spot in the mountains",
            "Dancing at your sister's wedding",
            "The day we said 'I love you'",
            "This year - still falling for you every day"
        ];

        // Generate photo cards (with XSS protection)
        const grid = document.getElementById('photoGrid');
        photos.forEach((photo, index) => {
            const card = document.createElement('div');
            card.className = 'photo-card';

            // Security: Use escapeHtml to prevent XSS from photo filenames/captions
            const safePhoto = escapeHtml(photo);
            const safeCaption = escapeHtml(defaultCaptions[index] || '');

            card.innerHTML = `
                <div class="photo-number">${index + 1}</div>
                <img src="customize/photos/${safePhoto}" alt="Photo ${index + 1}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22250%22><rect fill=%22%23333%22 width=%22400%22 height=%22250%22/><text fill=%22%23999%22 x=%22200%22 y=%22130%22 text-anchor=%22middle%22>Image not found</text></svg>'">
                <div class="photo-info">
                    <div class="photo-filename">${safePhoto}</div>
                    <label>Caption</label>
                    <textarea id="caption-${index}" placeholder="Enter caption for this photo..." maxlength="500">${safeCaption}</textarea>
                </div>
            `;
            grid.appendChild(card);
        });

        function generateConfig() {
            const memories = photos.map((photo, index) => {
                const caption = document.getElementById(`caption-${index}`).value.trim() || 'A special moment';
                return { photo, caption };
            });

            const messages = {
                title: document.getElementById('msg-title').value,
                subtitle: document.getElementById('msg-subtitle').value,
                startButton: document.getElementById('msg-startButton').value,
                loadingMessage: document.getElementById('msg-loadingMessage').value,
                victoryTitle: document.getElementById('msg-victoryTitle').value,
                victorySubtitle: document.getElementById('msg-victorySubtitle').value,
                finalMessage: document.getElementById('msg-finalMessage').value,
                signature: document.getElementById('msg-signature').value
            };

            const output = {
                memories,
                messages
            };

            document.getElementById('output').textContent = JSON.stringify(output, null, 2);
        }

        function copyToClipboard() {
            const output = document.getElementById('output').textContent;
            navigator.clipboard.writeText(output).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            });
        }
    </script>
</body>
</html>
